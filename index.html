<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>LucrativeClix Coin Faucet (LCC)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Ethers v6 -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.min.js"></script>

  <!-- WalletConnect -->
  <script type="module">
    import EthereumProvider from "https://unpkg.com/@walletconnect/ethereum-provider/dist/index.min.js";
    window.WalletConnectProvider = EthereumProvider;
  </script>

  <!-- reCAPTCHA -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <style>
    body {
      background:
        radial-gradient(circle at 20% 20%, #6a00ff, transparent 40%),
        radial-gradient(circle at 80% 30%, #ff2fd1, transparent 45%),
        radial-gradient(circle at 50% 80%, #00e5ff, transparent 40%),
        #02010a;
      color: white;
      font-family: Poppins, system-ui;
      min-height: 100vh;
    }
    .card {
      background: rgba(0,0,0,.65);
      backdrop-filter: blur(14px);
      border-radius: 24px;
    }
    .glow {
      text-shadow: 0 0 15px #b300ff, 0 0 30px #ff2fd1;
    }
  </style>
</head>

<body class="flex flex-col items-center justify-center px-4">

  <!-- HEADER -->
  <header class="text-center mb-10">
    <h1 class="text-5xl font-extrabold glow">ğŸŒŒ LucrativeClix Coin</h1>
    <p class="mt-3 text-gray-300">
      Official LCC Faucet â€¢ Sepolia Testnet
    </p>
  </header>

  <!-- CARD -->
  <div class="card p-8 w-full max-w-md shadow-2xl text-center">

    <button id="connectBtn"
      class="w-full bg-purple-600 py-3 rounded-xl font-bold hover:scale-105 transition mb-4">
      ğŸ”— Connect Wallet
    </button>

    <div id="walletStatus" class="text-sm text-gray-300 mb-4">
      Wallet not connected
    </div>

    <!-- CAPTCHA -->
    <div class="mb-4">
      <div class="g-recaptcha"
        data-sitekey="YOUR_RECAPTCHA_SITE_KEY"></div>
    </div>

    <button id="claimBtn"
      disabled
      class="w-full bg-pink-500 py-3 rounded-xl font-bold opacity-50 cursor-not-allowed">
      ğŸš€ Claim 0.1 LCC
    </button>

    <p id="status" class="mt-4 text-sm"></p>
  </div>

  <footer class="mt-10 text-gray-400 text-sm">
    Â© 2025 LucrativeClix Coin
  </footer>

<script>
/* ================= CONFIG ================= */

const SEPOLIA_CHAIN_ID = "0xaa36a7"; // 11155111
const BACKEND_URL = "/api/claim";   // works on Vercel + local

let provider;
let signer;
let userAddress;

/* ================= ELEMENTS ================= */

const connectBtn = document.getElementById("connectBtn");
const claimBtn   = document.getElementById("claimBtn");
const walletStatus = document.getElementById("walletStatus");
const statusEl = document.getElementById("status");

/* ================= HELPERS ================= */

function isMobile() {
  return /Android|iPhone|iPad/i.test(navigator.userAgent);
}

/* ================= CONNECT WALLET ================= */

connectBtn.onclick = async () => {
  statusEl.textContent = "";

  // MetaMask present (desktop OR mobile browser)
  if (window.ethereum) {
    await connectMetaMask();
    return;
  }

  // Mobile deep link
  if (isMobile()) {
    window.location.href =
      "https://metamask.app.link/dapp/" +
      window.location.href.replace(/^https?:\/\//, "");
    return;
  }

  // WalletConnect fallback
  await connectWalletConnect();
};

async function connectMetaMask() {
  try {
    provider = new ethers.BrowserProvider(window.ethereum);

    await provider.send("eth_requestAccounts", []);

    // Force Sepolia
    await window.ethereum.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: SEPOLIA_CHAIN_ID }]
    });

    signer = await provider.getSigner();
    userAddress = await signer.getAddress();

    walletStatus.textContent = "âœ… Connected: " + short(userAddress);
    enableClaim();

  } catch (err) {
    statusEl.textContent = "âŒ Wallet connection failed";
    console.error(err);
  }
}

async function connectWalletConnect() {
  try {
    const wc = await window.WalletConnectProvider.init({
      projectId: "YOUR_WALLETCONNECT_PROJECT_ID",
      chains: [11155111],
      showQrModal: true
    });

    await wc.enable();

    provider = new ethers.BrowserProvider(wc);
    signer = await provider.getSigner();
    userAddress = await signer.getAddress();

    walletStatus.textContent = "âœ… Connected: " + short(userAddress);
    enableClaim();

  } catch (err) {
    statusEl.textContent = "âŒ WalletConnect failed";
    console.error(err);
  }
}

/* ================= CLAIM ================= */

claimBtn.onclick = async () => {
  if (!grecaptcha.getResponse()) {
    statusEl.textContent = "âš ï¸ Complete reCAPTCHA";
    return;
  }

  try {
    claimBtn.disabled = true;
    statusEl.textContent = "â›“ï¸ Sending claim request...";

    const res = await fetch(BACKEND_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ address: userAddress })
    });

    const data = await res.json();

    if (!data.success) {
      throw new Error(data.error || "Claim failed");
    }

    statusEl.innerHTML =
      `ğŸ‰ LCC sent!<br>
       <a class="text-blue-400 underline"
       target="_blank"
       href="https://sepolia.etherscan.io/tx/${data.txHash}">
       View transaction</a>`;

    grecaptcha.reset();

  } catch (err) {
    statusEl.textContent = "âŒ " + err.message;
    claimBtn.disabled = false;
  }
};

/* ================= UTIL ================= */

function enableClaim() {
  claimBtn.disabled = false;
  claimBtn.classList.remove("opacity-50","cursor-not-allowed");
}

function short(addr) {
  return addr.slice(0,6) + "..." + addr.slice(-4);
}
</script>

</body>
      </html>
